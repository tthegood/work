<html>
  <head>
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css">
    <!-- Compiled and minified JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js'></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  </head>

  <body>
    <nav>
      <div class="nav-wrapper black white-text">
        <a href="#" class="brand-logo">Dashboard</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li><a href="sass.html">Sass</a></li>
          <li><a href="badges.html">Components</a></li>
          <li><a href="collapsible.html">JavaScript</a></li>
        </ul>
      </div>
    </nav>

    <div class="row">
        <div class="col s12 m6">
          <div class="card">
            <div class="card-content black-text">
              <span class="card-title">Top 10 COVID deaths</span>
              <div id='output'></div>
            </div>
          </div>
        </div> <!-- end of col -->

        <div class="col s12 m6">
          <div class="card">
            <div class="card-content black-text">
              <span class="card-title">Map</span>
              <div id='map' style='width:100%; height:63%;'></div>
            </div>
            <div style='float:left'>
              <div style="padding:5px;background-color:'red'"></div>
            </div>
          </div>
        </div> <!-- end of col -->


    </div>
    <div class="row">
      <div class="col s12 m6">
        <div class="card">
          <div class="card-content black-text">
            <span class="card-title">Card Title</span>
            <p>I am a very simple card. I am good at containing small bits of information.
            I am convenient because I require little markup to use effectively.</p>
          </div>
        </div>
      </div> <!-- end of col -->

      <div class="col s12 m6">
        <div class="card">
          <div class="card-content black-text">
            <span class="card-title">Card Title</span>
            <p>I am a very simple card. I am good at containing small bits of information.
            I am convenient because I require little markup to use effectively.</p>
          </div>
        </div>
      </div> <!-- end of col -->


    </div>

  </body>

  <script>

    axios.get('https://www.trackcorona.live/api/countries')
      .then(response => {
        buildList(response.data.data);
        mapAlgo(response.data.data);
      })

    //mapIt();

    function mapAlgo(response) {
      var map = L.map('map').setView([20, 0], 2);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      for (i=0; i<response.length; i++){
        let lat = response[i].latitude;
        let lon = response[i].longitude;
        var radius = parseInt(response[i].dead) * 2;
        var popup = "<h6>" + response[i].location + "</h6><p>" + response[i].dead + "</p>";
        if (i<10) {
          var c = 'red';
        } else if (i >= 10 && i<150){
          var c = 'orange';
        } else {
          var c = 'yellow';
        }
        L.circle([lat, lon],{color:c, radius}).addTo(map).bindPopup(popup);
      }
    }

    function mapIt() {
      var map = L.map('map').setView([51.505, -0.09], 13);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      L.marker([51.5, -0.09]).addTo(map)
          .bindPopup('A pretty CSS3 popup.<br> Easily customizable.')
          .openPopup();
    }

    function buildList(data) {
      var dHandle = document.getElementById('output');
      var myHTML = "<ul class='collection'>";

      data.sort(function (a, b) {
        return b.dead - a.dead;
      });
      for (i=0; i<10; i++) {
        myHTML = myHTML + '<li>' + data[i].location + "<span class='badge'>" + data[i].dead
      }

      myHTML = myHTML + '</ul>';
      dHandle.innerHTML = myHTML;
    }
  </script>
</html>
